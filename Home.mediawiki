<h4>'''libwdi: a Windows Driver Installer library for USB devices'''</h4>

[[images/libwdi.png]]

= Description =
== About ==

The aim of this project is to provide Windows application developers and driver makers, with a convenient way of extracting and installing USB drivers on end-users systems. Such drivers can then be used with, but not limited to, libusb applications using [https://libusb.info libusb], [https://sourceforge.net/p/libusb-win32/wiki/Home/ libusb-win32] or [http://libusbk.sourceforge.net/UsbK3/index.html libusbK].

== Getting Support ==

If you have a question that cannot be answered in these pages, your best option is to send a mail to the [http://lists.sourceforge.net/lists/listinfo/libwdi-devel libwdi-devel mailing list] (registration required). Or you can also try to e-mail [mailto://pete@akeo.ie?subject=libwdi the developers] directly.

Alternatively, you can also use the github facility to [https://github.com/pbatard/libwdi/issues log an issue].

== Features ==

=== Main Features ===

* Automated '''signed''' driver package creation and installation, using the name reported by the USB device
* '''No''' security warnings during driver installation, when running in elevated mode
* One-off [[WCID Devices|WCID device]] driver installation support, so that no further driver installation is required for any WCID device of the same type
* Dual 32 and 64 bit platform support
* Supports Windows platforms from Windows 7 up to Windows 10
* Single library that can be statically or dynamically linked to your application in order to provide driver installation facilities at runtime

=== Additional Features ===

* Embedding of [https://docs.microsoft.com/en-us/windows-hardware/drivers/usbcon/winusb WinUSB] ([https://libusb.info libusb], [http://libusbdotnet.sf.net LibUsbDotNet], native), [https://sourceforge.net/p/libusb-win32/wiki/Home/ libusb-win32], [http://libusbk.sourceforge.net/UsbK3/index.html libusbK] or your own USB drivers.
* [https://sourceforge.net/p/libusb-win32/wiki/Home/ libusb-win32] filter driver support
* UAC elevation, where necessary
* Full locale support with UTF-8 API strings and UTF-16 autogenerated inf files
* Resolution of USB Vendor IDs, based on the [http://www.linux-usb.org/usb-ids.html USB ID Repository]
* Fully Open Source ([https://www.gnu.org/licenses/lgpl.html LGPL v3]), with multiple sample applications
* Supports [http://www.mingw.org/ MinGW]  and [https://mingw-w64.org MinGW-w64]

= Downloads =

* <h4>'''[https://github.com/pbatard/libwdi/releases/tag/v1.3.1 libwdi v1.3.1]''', released 2020.03.30 ([https://github.com/pbatard/libwdi/blob/master/ChangeLog ChangeLog])</h4>
* <h4>'''[https://github.com/pbatard/libwdi/releases/ All libwdi releases]'''</h4>
* <h4>'''[https://zadig.akeo.ie/ Zadig]''', a standalone driver installer GUI application, built on libwdi.</h4>

= Documentation =

# <h4>'''[[FAQ]]'''</h4>
# <h4>'''[[Zadig|Using Zadig (the GUI driver installer application)]]'''</h4>
# <h4>'''[[Install|Library Installation & Configuration]]'''</h4>
# <h4>'''[[Compiling-and-debugging-libwdi-or-Zadig|Compiling and debugging Zadig using Visual Studio 2019 Community Edition]]'''</h4>
# <h4>'''[[Usage|Library API Documentation & Usage]]'''</h4>
# <h4>'''[[Signed Driver Walkthrough|Signed driver installation walkthrough]]'''</h4>
# <h4>'''[[WCID Devices]]'''</h4>

= Reusable Code Parts: Can our code solve your problems? =

As a Free Software developer, there's nothing more frustrating than having to reinvent the wheel while harbouring a strong suspicion that someone, somewhere, might already have solved a similar issue.
On the other hand, googling around and looking through scores of FOSS code listings to find that particular section of code which might be of interest to you is quite time consuming. Wouldn't it be just swell if the developers simply gave an detailed, high level overview of the problems they solved, whose solutions they think you can reuse?

The following page does just that and goes through a list of the features we implemented, which you might be interested in (provided your license is compatible with LGPL):
* <h4 style="margin:0; padding:0">'''[[Reuse|libwdi reuse]]'''</h4>

= Development =

== Supported Environments ==

The following development environments are currently supported for libwdi on Windows:
* [http://www.mingw.org MinGW] (32 bit) or [https://mingw-w64.org MinGW-w64]. To compile a library that is both 32 and 64 bit compatible, you should use a version of MinGW-w64 that supports both <code>-m32</code> and <code>-m64</code> (a.k.a. "multilib", which the current MinGW-w64 sadly does not properly support).
* [https://visualstudio.microsoft.com/vs/community/ Microsoft Visual Studio 2019 Community Edition], which is '''freely available''' for anyone wishing to recompile, run or debug libwdi.

== Source ==

The current development tree is available from our [https://github.com/pbatard/libwdi GitHub repository].

For those not familiar with git, here are the git commands you can use retrieve and compile libwdi:
<pre>
git clone git://github.com/pbatard/libwdi.git ; retrieve development branch (this only needs to be done once)
git pull                                      ; for further updates, once the clone has been done
</pre>

If you don't want to use git from the commandline, you can use [https://tortoisegit.org/ TortoiseGit] to access and keep in sync with the git repository. Note that before you can install [https://tortoisegit.org/ TortoiseGit] you need to install [https://git-for-windows.github.io/ Git for Windows].

Also note that, for MinGW you need to run <code>./autogen.sh</code> (after editing it according to your paths) or run the autotools creation utilities, in order to have configure and Makefile created for you.

To create projects relying on libwdi, please refer to how the sample executables zadic, wdi-simple (console) or zadig (GUI) are compiled.

== Development Considerations ==

* Because driver installation requires administrative privileges, but enumeration does not, the library compiles and embeds a 32/64 bit installer which will require elevation on platforms supporting UAC.
* The project also uses a customer embedder to include the required driver resources (DLLs, 32 and 64 bit installer) along with any files you want to add (eg. signed inf).
* The reliance on <code>DifXAPI.dll</code>, which we originally used, was dropped early on as the DLL was not available on XP and embedding it would drastically increase the binary size.
* It is possible to produce a 32 bit library that is 32+64 bit compatible, but the opposite is not true. As such, when compiling for 64 bit, 32 bit compatibility will be removed to make the library smaller.

== Links ==

* [https://docs.microsoft.com/en-us/windows-hardware/drivers/install/writing-a-device-installation-application Writing a Device Installation Application]
* [https://docs.microsoft.com/en-us/windows-hardware/drivers/install/determining-whether-a-device-is-plugged-in Determining Whether a Device Is Plugged In and removal of phantom devices]
* [https://msdn.microsoft.com/en-us/library/bb530410.aspx#vistauac_topic3 Installer Detection for 32 bit applications]
* [https://jpassing.com/2008/02/01/how-to-use-manifests-with-buildexe/ Embedding manifests (for UAC elevation) with the DDK build environment]
* [https://download.microsoft.com/download/e/b/a/eba1050f-a31d-436b-9281-92cdfeae4b45/setupapilog.doc Troubleshooting Device Installation with the SetupAPI Log File]
* [https://docs.microsoft.com/en-us/windows-hardware/drivers/install/debugging-device-installations--windows-vista-and-later- Debugging Device Installation in Windows Vista]
* [https://docs.microsoft.com/en-us/windows-hardware/drivers/install/how-setup-selects-drivers How Windows elects the driver to use against a newly plugged device]
* [https://docs.microsoft.com/en-us/windows-hardware/drivers/wdf/using-inx-files-to-create-inf-files Using INX Files to Create INF Files]
* [https://docs.microsoft.com/en-us/windows-hardware/drivers/install/summary-of-inf-sections Summary of INF Sections]
* [https://docs.microsoft.com/en-us/windows/desktop/SecCrypto/cryptography-functions Microsoft's cryptographic functions]